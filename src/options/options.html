<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 划词解释 - 设置</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
      </div>
      <h1>AI 划词解释</h1>
      <p class="subtitle">配置你的 AI 模型 API</p>
    </header>

    <main>
      <section class="config-section">
        <h2>AI 模型配置</h2>

        <!-- 模型选择 -->
        <div class="form-group">
          <label>AI 提供商</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="provider" value="openai" checked>
              <span>OpenAI</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="provider" value="gemini">
              <span>Gemini (Google)</span>
            </label>
          </div>
        </div>

        <!-- API Key -->
        <div class="form-group">
          <label for="apiKey">API Key <span class="required">*</span></label>
          <div class="input-group">
            <input type="password" id="apiKey" placeholder="sk-..." />
            <button type="button" id="toggleApiKey" class="icon-btn" title="显示/隐藏">
              <svg class="eye-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
          <small class="help-text">你的 API Key 将安全地存储在本地</small>
        </div>

        <!-- API Endpoint -->
        <div class="form-group">
          <label for="apiEndpoint">API Endpoint</label>
          <input type="text" id="apiEndpoint" placeholder="留空使用默认地址" />
          <small class="help-text">可选，留空使用官方 API 地址</small>
        </div>

        <!-- Model -->
        <div class="form-group">
          <label for="model">模型名称</label>
          <select id="model">
            <optgroup label="OpenAI 模型" id="openai-models">
              <option value="gpt-4o">GPT-4o</option>
              <option value="gpt-4o-mini" selected>GPT-4o Mini</option>
              <option value="gpt-4-turbo">GPT-4 Turbo</option>
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
            </optgroup>
            <optgroup label="Gemini 模型" id="gemini-models" style="display: none;">
              <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
              <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
              <option value="gemini-pro">Gemini Pro</option>
            </optgroup>
          </select>
        </div>

        <!-- 高级设置 -->
        <div class="form-group">
          <button type="button" id="toggleAdvanced" class="toggle-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
            高级设置
          </button>
          <div id="advancedSettings" class="advanced-settings" style="display: none;">
            <div class="form-group">
              <label for="temperature">
                Temperature: <span id="tempValue">0.7</span>
              </label>
              <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" />
              <small class="help-text">控制输出的随机性，越高越随机</small>
            </div>
            <div class="form-group">
              <label for="maxTokens">Max Tokens</label>
              <input type="number" id="maxTokens" min="100" max="4000" step="100" value="1000" />
              <small class="help-text">最大生成长度</small>
            </div>
          </div>
        </div>

        <!-- 按钮组 -->
        <div class="button-group">
          <button type="button" id="saveBtn" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            保存配置
          </button>
          <button type="button" id="testBtn" class="btn btn-secondary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
            测试连接
          </button>
        </div>

        <!-- 状态消息 -->
        <div id="statusMessage" class="status-message" style="display: none;"></div>
      </section>

      <!-- 上下文配置 -->
      <section class="config-section">
        <h2>上下文配置</h2>

        <!-- 启用上下文 -->
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="useContext" checked>
            <span>启用上下文感知</span>
          </label>
          <small class="help-text">提取网页内容作为上下文，让 AI 更准确地解释选中文本</small>
        </div>

        <!-- 上下文模式 -->
        <div class="form-group" id="contextModeGroup">
          <label for="contextMode">上下文模式</label>
          <select id="contextMode">
            <option value="economic">经济模式 (~2000 tokens)</option>
            <option value="standard" selected>标准模式 (~6000 tokens)</option>
            <option value="precise">精确模式 (~12000 tokens)</option>
          </select>
          <small class="help-text">选择上下文提取的详细程度，token 消耗会相应增加</small>
        </div>

        <!-- 高亮开关 -->
        <div class="form-group" id="highlightGroup">
          <label class="checkbox-label">
            <input type="checkbox" id="enableHighlight" checked>
            <span>启用上下文高亮</span>
          </label>
          <small class="help-text">在页面上高亮显示 AI 参考的上下文内容（三层级黄色高亮）</small>
        </div>
      </section>

      <!-- Prompt 模板配置 -->
      <section class="config-section">
        <h2>Prompt 模板</h2>

        <!-- 模板选择 -->
        <div class="form-group">
          <label for="promptTemplateSelect">模板选择</label>
          <select id="promptTemplateSelect">
            <option value="template:default" selected>默认模板（通用解释）</option>
            <option value="template:technical">技术文档模板</option>
            <option value="template:academic">学术论文模板</option>
            <option value="template:code">代码理解模板</option>
            <option value="custom">自定义模板</option>
          </select>
        </div>

        <!-- 自定义模板编辑器 -->
        <div class="form-group" id="customTemplateGroup" style="display: none;">
          <label for="customPromptTemplate">自定义模板</label>
          <textarea id="customPromptTemplate" rows="12" class="code-editor" placeholder="输入自定义 Prompt 模板..."></textarea>
          <div class="template-variables">
            <strong>可用变量：</strong>
            <code>{{pageTitle}}</code> - 网页标题 |
            <code>{{pageUrl}}</code> - 网页链接 |
            <code>{{context}}</code> - 上下文内容 |
            <code>{{selectedText}}</code> - 选中的文本 |
            <code>{{contextTokens}}</code> - 上下文 token 数
          </div>
        </div>

        <!-- 模板预览按钮 -->
        <div class="form-group">
          <button type="button" id="previewTemplate" class="btn btn-secondary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            预览模板
          </button>
        </div>
      </section>

      <section class="help-section">
        <h2>使用说明</h2>
        <ol>
          <li>选择 AI 提供商（OpenAI 或 Gemini）</li>
          <li>输入你的 API Key（必填）</li>
          <li>可选择自定义 API Endpoint</li>
          <li>选择要使用的模型</li>
          <li>调整高级参数（可选）</li>
          <li>点击"保存配置"完成设置</li>
        </ol>
        <p><strong>使用方法：</strong>在任意网页上选中文字，点击出现的"AI解释"按钮即可获取解释。</p>

        <div class="links">
          <h3>相关链接</h3>
          <ul>
            <li><a href="https://platform.openai.com/api-keys" target="_blank">获取 OpenAI API Key</a></li>
            <li><a href="https://makersuite.google.com/app/apikey" target="_blank">获取 Gemini API Key</a></li>
            <li><a href="https://github.com" target="_blank">项目仓库</a></li>
          </ul>
        </div>
      </section>
    </main>

    <footer>
      <p>AI 划词解释 v1.0.0 | 数据仅存储在本地，不会上传至任何服务器</p>
    </footer>
  </div>

  <script src="options.js"></script>
</body>
</html>
